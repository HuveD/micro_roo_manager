# Subtask Attempt and Completion Protocol

**Objective:** To guide the AI (Task Performer/Reporter) in attempting assigned Subtasks using the `attempt_completion` tool and **mandatorily concluding the tool's use by generating either a Completion or Handover Report** based on the outcome.

---

**I. Core Principles for Task Attempt and Reporting**

1.  **Request Adherence:** Attempt to execute the task strictly based on the `Goal`, `CONTEXT`, and `Constraints` provided in the received `Subtask Request` (`subtask_protocol.md`).
2.  **Format Adherence & Tool Usage:** The primary mechanism for finalizing a subtask attempt is the `attempt_completion` tool. **This tool *must* be invoked only as the *final step* after all other necessary actions (including validation, analysis, command execution if permitted and required, etc.) related to the task are fully completed.** Invoking this tool mandates the generation of either a `Subtask Completion Report` (Section II) upon successful completion OR a `Subtask Handover Report` (Section III) if the attempt is halted. **Crucially, the `attempt_completion` tool call MUST NOT include a `<command>` tag.** No further actions or tool calls should occur after `attempt_completion` is invoked. Strictly adhere to the defined report formats. Replace `[TASK_TITLE]` with the specific title from the request.
3.  **Clarity and Specificity:** Ensure the content of each report item is specific and unambiguous, allowing clear understanding by other AIs or humans reviewing the report.
4.  **Scope Adherence:** Perform tasks strictly within the scope defined in the `Constraints` section of the Subtask Request. If a required action falls outside this scope, **immediately cease the attempt** and proceed to generate a `Subtask Handover Report` (Section III) via the `attempt_completion` tool.

---

**II. Subtask Completion Report Format**

*   **Purpose:** To clearly report the results and relevant information when a task attempt is successfully completed as per the request.
*   **Instruction:** Use this format *only* upon successful completion of all tasks defined within the scope of the request, **as the *final* output generated by the `attempt_completion` tool.** **Do NOT include a `<command>` tag within the `attempt_completion` call.** No further actions should be taken after invoking this tool. Replace `[TASK_TITLE]` with the specific title from the request.

```markdown
# [TASK_TITLE] Completion Report
*Example: # Analyze User Feedback Completion Report*

*Provide a concise summary of the work performed and the final result achieved.*

## CONTEXT
*List key information or changes directly resulting from the completed task (e.g., path to generated files, key decisions made, final state relevant for future tasks).*
- e.g., Final output generated at: `/output/feedback_summary_report.txt`
- e.g., Key finding: "Positive sentiment increased by 15% after UI update."
- e.g., Database record updated: ID `user_feedback_analysis_#123`

## (Optional) Scope of Changes & Impact
*Describe any modifications made (e.g., to code, documents, system state), including file paths and their **total line counts**, and their potential impact, if applicable and noteworthy.*
- e.g., Refactored `data_parser.py` (total 250 lines); unit tests passed, no expected impact on downstream modules.
- e.g., Updated documentation section 4.1 in `docs/analysis.md` (total 85 lines) regarding the new analysis method.

## (Optional) Notable Points
*Detail any exceptional situations, anomalies, or noteworthy points encountered during the task attempt (even if resolved), if applicable.*
- e.g., Encountered unexpected data format in 2 out of 100 files (handled by fallback logic).
- e.g., API endpoint `api.example.com/data` had a 5-minute outage during execution (retried successfully).
```

---

**III. Subtask Handover Report Format**

*   **Purpose:** To convey all necessary information when stopping a task attempt mid-execution (due to scope deviation or other interruptions) to enable another AI to potentially resume or re-attempt.
*   **Instruction:** Use this format when stopping the attempt before completion (due to scope deviation or other reasons). **Generate this report as the *final* output of the `attempt_completion` tool.** **Do NOT include a `<command>` tag within the `attempt_completion` call.** No further actions should be taken after invoking this tool. Replace `[TASK_TITLE]` with the specific title from the request.

```markdown
# [TASK_TITLE] Handover Report
*Example: # Analyze User Feedback Handover Report*

*Briefly describe the work completed during the attempt so far and explicitly state the reason for the handover.*

## Progress Status & Remaining Work
*Clearly distinguish between the tasks completed during the attempt and the remaining tasks required to fulfill the original request.*
- **Completed Tasks:**
    - e.g., Fetched user feedback data from source X.
    - e.g., Performed initial data cleaning and normalization.
    - e.g., Analyzed sentiment for the first 50% of the dataset.
- **Remaining Tasks:**
    - e.g., Analyze sentiment for the remaining 50% of the dataset.
    - e.g., Aggregate results and generate the final summary report.
    - e.g., Validate report against requirements checklist.

## CONTEXT
*Include ALL necessary context information for the receiving AI to understand the state at the point of handover. This includes existing context from the request plus any newly generated state or intermediate results.*
- e.g., Path to partially processed data: `/temp/partial_analysis_results.json`
- e.g., Current state variable: `last_processed_record_id = 500`
- e.g., Specific instructions for next step (if known): "Use `sentiment_analyzer_v2` for remaining data."
- e.g., Original CONTEXT provided in the Task Request should be implicitly carried over or summarized if critical.

## (Optional) Scope of Changes & Impact
*Describe any modifications made during the attempt so far, including file paths and their **total line counts**, and their potential impact (if applicable).*
- e.g., Added new function to `utils/helper.js` (total 120 lines).

## Reason for Handover
*Specify the concrete reason necessitating the handover, referencing the triggering condition.*
- **Mandatory Example:**
    - `Scope deviation: Request requires accessing external API not listed in Constraints. Halting attempt and handing over task.`
- **Other Possible Examples:**
    - `Task attempt interrupted by external high-priority directive.`
    - `Encountered unrecoverable error during processing.`

```

---

**IV. Correct Usage Example**

*   **Purpose:** To illustrate the correct invocation of the `attempt_completion` tool without the forbidden `<command>` tag.
*   **Instruction:** Always ensure the `attempt_completion` tool call only contains the `<result>` tag with the properly formatted report inside. Any necessary command execution (like running tests) must be completed *before* invoking `attempt_completion`.

```xml
<attempt_completion>
<result>
# [TASK_TITLE] Completion Report
*Example: # Refactor Data Parser Completion Report*

*Successfully refactored the data parsing module for improved efficiency and readability.*

## CONTEXT
- Refactoring completed according to plan.
- All unit tests passed post-refactoring (verified via separate `execute_command` call before this report).
- Generated file: `lib/data_parser_v2.py`

## Scope of Changes & Impact
- Modified file: `lib/data_parser_v2.py` (total 310 lines)
- Related test file: `tests/test_data_parser_v2.py` (total 150 lines)
- Expected impact: Improved performance in data processing pipeline.

## Notable Points
- Deprecated the old `data_parser.py` module.
</result>
</attempt_completion>
```

---

**Final Reminder:** Strict adherence to this protocol is mandatory. **Crucially, remember that the `attempt_completion` tool *must* be used only as the absolute final step of the task execution, concluding with either a Completion Report (Section II) or a Handover Report (Section III). The tool call itself MUST NOT contain a `<command>` tag. No operations should follow its invocation.**
